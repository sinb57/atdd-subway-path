# 기능 구현 목록

---

### 지하철역 관리 API 기능

- 지하철역 등록
    - [x] 등록하고자 하는 지하철역의 `이름`이 필요하다.
        - [x] `이름`은 공백이 될 수 없다.
    - [x] 지하철역 이름은 중복될 수 없다.


- 지하철역 목록
    - [x] 존재하는 모든 지하철역을 반환한다.


- 지하철역 삭제
    - [x] 삭제하고자 하는 `지하철역 ID`가 필요하다.
        - [x] 존재하는 지하철역이어야 한다.
    - [x] 해당 지하철역을 삭제한다.
        - [x] 해당 지하철역을 구간으로 지니고 있는 노선이 존재하면 삭제할 수 없다.

---

### 지하철노선 관리 API 기능

- 지하철노선 등록
    - [x] 등록하고자 하는 지하철노선의 `이름`, `색상`, `상행역 ID`, `하행역 ID`, `거리`, `추가 요금`이 필요하다.
        - [x] `이름`은 공백이 될 수 없다.
        - [x] `이름`은 중복될 수 없다.
        - [x] `색상`은 공백이 될 수 없다.
        - [x] `색상`은 중복될 수 없다.
        - [x] `상행역 ID`에 해당하는 지하철역이 존재해야 한다.
        - [x] `하행역 ID`에 해당하는 지하철역이 존재해야 한다.
        - [x] `상행역 ID`와 `하행역 ID`는 달라야 한다.
        - [x] `거리`는 양수여야 한다.
        - [x] `추가요금`은 양수여야 한다.


- 지하철노선 목록
    - [x] 존재하는 모든 지하철노선을 반환한다.


- 지하철노선 조회
    - [x] 조회하고자 하는 `지하철노선 ID`가 필요하다.
        - [x] 존재하는 지하철노선이어야 한다.
    - [x] 지정된 지하철노선을 반환한다.


- 지하철노선 수정
    - [x] 수정하고자 하는 `지하철노선 ID`가 필요하다.
        - [x] 존재하는 지하철노선이어야 한다.
    - [x] 등록하고자 하는 `이름`, `색상`이 필요하다.
        - [x] `이름`은 공백이 될 수 없다.
        - [x] `색상`은 공백이 될 수 없다.
    - [x] 지정된 지하철노선의 `이름`과 `색상`을 수정한다.


- 지하철노선 삭제
    - [x] 삭제하고자 하는 `지하철노선 ID`가 필요하다.
        - [x] 존재하는 지하철노선이어야 한다.
    - [x] 지정된 지하철노선을 삭제한다.
      -  [x] 지하철노선의 모든 구간을 삭제한다.

---

### 지하철구간 등록

- 지하철구간 등록
    - [x] 등록하고자 하는 지하철구간의 `상행역 ID`, `하행역 ID`, `거리`가 필요하다.
        - [x] `상행역 ID`에 해당하는 지하철역이 존재해야 한다.
        - [x] `하행역 ID`에 해당하는 지하철역이 존재해야 한다.
        - [x] `상행역 ID`와 `하행역 ID`는 달라야 한다.
        - [x] `거리`는 양수여야 한다.
    - [x] 새로 등록할 구간의 상행역과 하행역 중 노선에 이미 등록되어 있는 역을 기준으로 새로운 구간을 추가한다.
        - [x] 상행 종점 등록
          <img src="https://nextstep-storage.s3.ap-northeast-2.amazonaws.com/2d4654cc24f949c1818773df2ae57890" style="width:700px;">

        - [x] 하행 종점 등록
          ![image.png](https://nextstep-storage.s3.ap-northeast-2.amazonaws.com/832a8b49635c40b58f16fae1726909f6)

        - 갈래길 방지
            - [x] 하나의 노선에는 갈래길이 허용되지 않기 때문에 새로운 구간이 추가되기 전에 갈래길이 생기지 않도록 기존 구간을 변경한다.
              ![image.png](https://nextstep-storage.s3.ap-northeast-2.amazonaws.com/be71b2febc0c4d179c6606f9fe1a473b)
            - [x] 역 사이에 새로운 역을 등록할 경우 기존 역 사이 길이보다 크거나 같으면 등록을 할 수 없다.
              ![image.png](https://techcourse-storage.s3.ap-northeast-2.amazonaws.com/dadbeaff524047c7a56ba2898b803995)

            - [x] 상행역과 하행역이 이미 노선에 모두 등록되어 있다면 추가할 수 없다.
            - 아래의 이미지 에서 A-B, B-C 구간이 등록된 상황에서 B-C 구간을 등록할 수 없다.(A-C 구간도 등록할 수 없음)
              ![image.png](https://techcourse-storage.s3.ap-northeast-2.amazonaws.com/7290f728d350426798ae6330ec4de730)
            - [x] 상행역과 하행역 둘 중 하나도 포함되어 있지 않으면 추가할 수 없다.
              ![image.png](https://techcourse-storage.s3.ap-northeast-2.amazonaws.com/60c4586d8efe487fb9bdbff262af5261)

- 지하철구간 제거
    - [x] 삭제하고자 하는 지하철구간의 `지하철노선 ID`, `지하철역 ID`가 필요하다.
        - [x] `지하철노선 ID`에 해당하는 지하철노선이 존재해야 한다.
        - [x] `지하철역 ID`에 해당하는 지하철역이 존재해야 한다.
        - [x] 해당 지하철노선이 해당 지하철역을 구간으로 지니고 있어야 한다.
    - [x] 해당 지하철노선에서 해당 지하철역을 삭제한다.
        - [x] 종점이 제거될 경우, 종점에 인접한 지하철역이 종점이 된다.
        - [x] 중간역이 제거될 경우, 구간을 재배치한다.
            - 노선에 A-B-C 역이 연결되어 있을 때 B 역을 제거하면 A-C로 재배치한다.
            - 이 때, 거리는 두 구간의 거리 합으로 결정한다.
              ![image.png](https://nextstep-storage.s3.ap-northeast-2.amazonaws.com/a8751b272c36421481c779e5a743a928)
        - [x] 구간이 하나인 노선에서는 종점을 제거할 수 없다.
          ![image.png](https://techcourse-storage.s3.ap-northeast-2.amazonaws.com/d1461b625bc44ad0b6f0cd6430ec281a)

### 지하철 경로 조회 API 기능

- [x] 출발역과 도착역 사이의 최단 거리 경로를 구하는 API
    - [x] 출발역과 도착역 사이의 최단 거리 경로 계산
        - [x] 한 노선에서 경로 찾기 뿐만 아니라 여러 노선의 환승도 고려하기
    - [x] 최단 거리를 기반으로 요금 계산
        - [x] 거리별 요금 측정
            - 기본운임(10㎞ 이내): 기본운임 1,250원
            - 이용 거리 초과 시 추가운임 부과
            - 10km~50km: 5km 까지 마다 100원 추가
            - 50km 초과: 8km 까지 마다 100원 추가
        - [x] 노선별 추가 요금
            - [x] 추가 요금이 있는 노선을 이용한 경우 측정된 요금에 추가
            - [x] 경로 중 추가 요금이 있는 노선을 환승하여 이용할 경우, 가장 높은 금액의 추가 요금만 적용
        - [ ] 연령별 요금 할인
            - [ ] 6세 미만 : 무료
            - [ ] 6세 이상 ~ 13세 미만 : 운임에서 350원을 공제한 금액의 50% 할인
            - [ ] 13세 이상 ~ 19세 미만 : 운임에서 350원을 공제한 금액의 20% 할인



---

### 리팩터링 및 테스트 추가 사항

- [ ] Controller 계층의 DTO 에서 @Valid 를 통한 유효성 검증 로직 추가
- [ ] Controller 계층에서의 Exception 핸들링
- [ ] Service 계층 테스트 작성
- [ ] 인수테스트 예외케이스 보충
- [ ] 거리별 요금 측정 로직 리팩터링